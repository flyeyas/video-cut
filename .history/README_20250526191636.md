# 视频智能镜头分割与组合工具

这个项目提供了两个主要功能：

1. **视频镜头分割**：将视频按照场景内容变化自动分割成多个片段
2. **视频随机组合**：根据指定时长，从视频库中随机选择并组合视频片段

## 功能介绍

### 视频镜头分割 (split-video.py)

这个工具使用 SceneDetect 库自动检测视频中的场景变化，并将视频分割成多个独立的片段。

**主要功能**：
- 自动检测视频中的场景变化
- 将视频分割成多个独立的片段
- 支持批量处理多个视频文件

### 视频随机组合 (video-combiner.py)

这个工具可以根据目标时长（可自动从音频文件获取），从视频库中智能选择视频片段并组合成一个新的视频，无需人工介入处理视频时长问题。

**主要功能**：
- 获取视频库中所有视频的时长信息
- 自动从音频文件获取目标时长
- 智能随机选择视频片段以匹配目标时长
- 自动裁剪时长较长的视频片段
- 自动确定最佳裁剪参数
- 将选中的视频片段无缝合并成一个新视频
- 支持使用已分割的场景片段

## 安装依赖

```bash
pip install moviepy scenedetect
```

## 使用方法

### 视频镜头分割

```bash
python src/split-video.py
```

在使用前，请修改脚本中的 `folder_path` 和 `output_path` 变量，指定输入视频文件夹和输出文件夹路径。

### 视频随机组合

```bash
python src/video-combiner.py --input <视频库文件夹> --output <输出视频路径> [--duration <目标时长(秒)>] [--audio <音频文件路径>] [--audio_folder <音频文件夹路径>] [--scene_folder <场景片段文件夹>] [--max_clip_duration <最大裁剪时长>]
```

**参数说明**：
- `--input`, `-i`: 输入视频文件夹路径
- `--output`, `-o`: 输出视频文件路径
- `--duration`, `-d`: (可选) 目标视频时长（秒），如不指定则自动从音频文件获取
- `--audio`, `-a`: (可选) 音频文件路径，用于自动确定目标时长
- `--audio_folder`, `-af`: (可选) 音频文件夹路径，将随机选择一个音频文件确定目标时长
- `--scene_folder`, `-s`: (可选) 已分割场景的文件夹路径，如果提供则优先使用场景片段
- `--max_clip_duration`, `-m`: (可选) 自动裁剪时的最大片段时长（秒），不指定则自动根据视频库情况确定

## 使用示例

### 1. 先分割视频场景

```bash
python src/split-video.py
```

### 2. 使用分割好的场景组合新视频

```bash
python src/video-combiner.py --input /path/to/videos --output combined_video.mp4 --duration 60 --scene_folder /path/to/scenes
```

这将创建一个时长约为60秒的视频，由随机选择的场景片段组成。

### 3. 直接从视频库组合新视频（指定时长）

```bash
python src/video-combiner.py --input /path/to/videos --output combined_video.mp4 --duration 120
```

这将创建一个时长约为120秒的视频，由随机选择的视频组成。

### 4. 根据音频文件时长组合视频

```bash
python src/video-combiner.py --input /path/to/videos --output combined_video.mp4 --audio /path/to/music.mp3
```

这将创建一个视频，其时长与指定的音频文件时长相匹配。

### 5. 从音频文件夹随机选择音频并组合视频

```bash
python src/video-combiner.py --input /path/to/videos --output combined_video.mp4 --audio_folder /path/to/music_folder
```

这将从音频文件夹中随机选择一个音频文件，并创建一个与该音频时长匹配的视频。

### 6. 自定义裁剪参数组合视频

```bash
python src/video-combiner.py --input /path/to/videos --output combined_video.mp4 --audio /path/to/music.mp3 --max_clip_duration 15
```

这将创建一个与音频时长匹配的视频，并限制每个裁剪片段的最大时长为15秒。

## 注意事项

- 视频分割工具会根据视频内容的变化自动检测场景，可以通过调整 `threshold` 参数来控制分割的灵敏度
- 视频组合工具会尽量选择时长合适的片段，使总时长接近目标时长
- 视频组合工具现在默认启用自动裁剪功能，当找不到合适时长的视频片段时，会自动从较长的视频中随机裁剪
- 如果未指定目标时长，工具会尝试从音频文件获取时长；如果未提供音频文件，则使用默认时长（60秒）
- 如果未指定最大裁剪时长，工具会根据视频库中视频的时长分布自动确定一个合适的值
- 处理大量或高清视频时可能需要较长时间
- 音频文件支持的格式包括：mp3、wav、aac、flac、ogg、m4a