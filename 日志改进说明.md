# VideoAnalyzer 日志改进说明

## 概述

我们为 `src/video_analyzer.py` 文件添加了全面的日志功能，以提供更好的运行状态监控、调试支持和问题诊断能力。

## 主要改进

### 1. 日志配置增强

- **文件输出**: 日志同时输出到控制台和 `video_analyzer.log` 文件
- **编码支持**: 日志文件使用 UTF-8 编码，支持中文字符
- **调试模式**: 新增 `set_debug_logging()` 函数，可启用详细的调试级别日志

```python
# 启用调试日志
set_debug_logging()
```

### 2. 初始化阶段日志

- **配置信息记录**: 记录数据库路径、特征版本、支持的视频格式
- **数据库操作**: 详细记录数据库表创建、连接状态
- **性能监控**: 记录数据库初始化耗时
- **数据统计**: 显示现有视频记录数量

### 3. 视频扫描过程日志

- **进度跟踪**: 实时显示扫描进度 (x/总数)
- **文件发现**: 记录找到的视频文件数量
- **批量进度**: 每处理10个文件记录一次进度百分比
- **错误统计**: 统计成功和失败的文件数量
- **性能数据**: 记录总耗时和平均处理速度

### 4. 特征提取日志

- **详细步骤**: 分别记录感知哈希和颜色直方图特征提取
- **性能监控**: 记录每种特征提取的耗时
- **数据统计**: 显示提取的特征数量
- **错误处理**: 详细记录特征提取过程中的错误

### 5. 相似度查找日志

- **查找参数**: 记录参考视频ID和相似度阈值
- **进度监控**: 每比较100个视频记录一次进度
- **结果统计**: 显示找到的相似视频数量和比较耗时
- **性能数据**: 记录总比较数量和处理速度

### 6. 命令行增强

- **调试选项**: 新增 `--debug` 参数启用调试模式
- **启动信息**: 记录程序启动参数和配置
- **异常处理**: 统一的错误处理和日志记录

## 日志级别说明

### INFO 级别
- 程序启动和完成信息
- 主要操作的开始和结果
- 进度更新和统计信息
- 配置参数记录

### DEBUG 级别
- 详细的操作步骤
- 数据库连接状态
- 特征提取详细过程
- 性能监控数据

### WARNING 级别
- 非致命性问题
- 空目录或无视频文件
- 处理失败的文件统计

### ERROR 级别
- 严重错误和异常
- 数据库操作失败
- 文件处理错误
- 特征提取失败

## 使用示例

### 基本使用
```bash
python src/video_analyzer.py --video-dir /path/to/videos --db-path videos.db
```

### 启用调试模式
```bash
python src/video_analyzer.py --video-dir /path/to/videos --db-path videos.db --debug
```

### 程序化使用
```python
from video_analyzer import VideoAnalyzer, set_debug_logging

# 启用调试日志
set_debug_logging()

# 创建分析器
analyzer = VideoAnalyzer('videos.db')

# 扫描视频库
count = analyzer.scan_video_library('/path/to/videos')
```

## 日志文件

- **位置**: 当前工作目录下的 `video_analyzer.log`
- **格式**: `时间戳 - 模块名 - 级别 - 消息`
- **编码**: UTF-8，支持中文
- **轮转**: 目前为追加模式，可根据需要配置日志轮转

## 性能监控

日志中包含以下性能指标：
- 数据库初始化耗时
- 视频扫描总耗时
- 单个视频处理时间
- 特征提取耗时（分类型）
- 相似度比较耗时
- 处理进度百分比

## 故障排除

通过日志可以快速定位以下问题：
- 数据库连接问题
- 视频文件格式不支持
- 特征提取失败原因
- 性能瓶颈位置
- 程序异常退出原因

## 注意事项

1. 调试模式会产生大量日志，建议仅在开发和调试时使用
2. 日志文件会持续增长，建议定期清理或配置日志轮转
3. 中文路径和文件名已正确支持UTF-8编码
4. 所有时间记录使用秒为单位，精确到小数点后2位
